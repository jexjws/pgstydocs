---
title: Playbook
description: 使用 ansible 运行 playbooks
icon: ScrollText
---

Pigsty 使用幂等的 [Ansible playbooks](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_intro.html) 实现管理控制器。
Playbooks 需要您的 `PATH` 中有 `ansible-playbook` 可执行文件。您必须[安装 ansible](/zh/admin/ansible#install) 才能运行 playbooks。

这里是 Pigsty 中的内置 playbooks，您也可以添加自己的。

|             模块              | Playbook                                                                               | 功能                                                    |
|:-------------------------------:|----------------------------------------------------------------------------------------|-------------------------------------------------------------|
|  [INFRA](/zh/infra/playbook)  | [`install.yml`](https://github.com/pgsty/pigsty/blob/main/install.yml)                 | 在当前节点上一键安装 Pigsty                  |
|  [INFRA](/zh/infra/playbook)  | [`infra.yml`](https://github.com/pgsty/pigsty/blob/main/infra.yml)                     | 在基础设施节点上初始化 pigsty 基础设施                   |
|  [INFRA](/zh/infra/playbook)  | [`infra-rm.yml`](https://github.com/pgsty/pigsty/blob/main/infra-rm.yml)               | 从基础设施节点移除基础设施组件           |
|  [INFRA](/zh/infra/playbook)  | [`cache.yml`](https://github.com/pgsty/pigsty/blob/main/cache.yml)                     | 从目标节点制作离线安装包              |
|  [INFRA](/zh/infra/playbook)  | [`cert.yml`](https://github.com/pgsty/pigsty/blob/main/cert.yml)                       | 使用 pigsty 自签名 CA 颁发证书（例如用于 pg 客户端） |
|   [NODE](/zh/node/playbook)   | [`node.yml`](https://github.com/pgsty/pigsty/blob/main/node.yml)                       | 为 pigsty 初始化节点，将节点调整到所需状态         |
|   [NODE](/zh/node/playbook)   | [`node-rm.yml`](https://github.com/pgsty/pigsty/blob/main/node-rm.yml)                 | 从 pigsty 移除节点                                     |
|  [PGSQL](/zh/pgsql/playbook)  | [`pgsql.yml`](https://github.com/pgsty/pigsty/blob/main/pgsql.yml)                     | 初始化 HA PostgreSQL 集群，或添加新副本         |
|  [PGSQL](/zh/pgsql/playbook)  | [`pgsql-rm.yml`](https://github.com/pgsty/pigsty/blob/main/pgsql-rm.yml)               | 移除 PostgreSQL 集群，或移除副本               |
|  [PGSQL](/zh/pgsql/playbook)  | [`pgsql-user.yml`](https://github.com/pgsty/pigsty/blob/main/pgsql-user.yml)           | 向现有 PostgreSQL 集群添加新业务用户        |
|  [PGSQL](/zh/pgsql/playbook)  | [`pgsql-db.yml`](https://github.com/pgsty/pigsty/blob/main/pgsql-db.yml)               | 向现有 PostgreSQL 集群添加新业务数据库    |
|  [PGSQL](/zh/pgsql/playbook)  | [`pgsql-monitor.yml`](https://github.com/pgsty/pigsty/blob/main/pgsql-monitor.yml)     | 使用本地导出器监控远程 postgres 实例       |
|  [PGSQL](/zh/pgsql/playbook)  | [`pgsql-migration.yml`](https://github.com/pgsty/pigsty/blob/main/pgsql-migration.yml) | 为现有 PostgreSQL 生成迁移手册和脚本 |
|  [PGSQL](/zh/pgsql/playbook)  | [`slim.yml`](https://github.com/pgsty/pigsty/blob/main/slim.yml)                       | 安装最小组件的 Pigsty                      |
|  [REDIS](/zh/redis/playbook)  | [`redis.yml`](https://github.com/pgsty/pigsty/blob/main/redis.yml)                     | 初始化 redis 集群/节点/实例                            |
|  [REDIS](/zh/redis/playbook)  | [`redis-rm.yml`](https://github.com/pgsty/pigsty/blob/main/redis-rm.yml)               | 移除 redis 集群/节点/实例                          |
|   [ETCD](/zh/etcd/playbook)   | [`etcd.yml`](https://github.com/pgsty/pigsty/blob/main/etcd.yml)                       | 初始化 etcd 集群（patroni HA DCS 必需）             |
|  [MINIO](/zh/minio/playbook)  | [`minio.yml`](https://github.com/pgsty/pigsty/blob/main/minio.yml)                     | 初始化 minio 集群（pgbackrest 仓库可选）           |
| [DOCKER](/zh/docker/playbook) | [`docker.yml`](https://github.com/pgsty/pigsty/blob/main/docker.yml)                   | 在节点上安装 docker                                     |
| [DOCKER](/zh/docker/playbook) | [`app.yml`](https://github.com/pgsty/pigsty/blob/main/app.yml)                         | 使用 docker compose 安装应用程序                     |
|     [FERRET](/zh/ferret/)     | [`mongo.yml`](https://github.com/pgsty/pigsty/blob/main/mongo.yml)                     | 在节点上安装 Mongo/FerretDB                             |


--------

## 部署 [#deployment]

特殊的 playbook `install.yml` 将使用临时 playbooks 部署所有内容：

| Playbook    | 命令       | 组      | `infra` | `[nodes]` | `etcd` | `minio` | `[pgsql]` |
|-------------|---------------|------------|:-------:|:---------:|:------:|:-------:|:---------:|
| `infra.yml` | `./infra.yml` | `-l infra` |    ✓    |     ✓     |        |         |           |
| `node.yml`  | `./node.yml`  |            |         |     ✓     |   ✓    |    ✓    |     ✓     |
| `etcd.yml`  | `./etcd.yml`  | `-l etcd`  |         |           |   ✓    |         |           |
| `minio.yml` | `./minio.yml` | `-l minio` |         |           |        |    ✓    |           |
| `pgsql.yml` | `./pgsql.yml` |            |         |           |        |         |     ✓     |