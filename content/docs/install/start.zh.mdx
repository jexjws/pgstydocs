---
title: 快速上手
description: 如何在您的 Linux 主机上安装 pigsty？
icon: CloudDownload
defaultOpen: false
---

import {DynamicLink} from 'fumadocs-core/dynamic-link';
import {Step, Steps} from 'fumadocs-ui/components/steps';
import {File, Folder, Files} from 'fumadocs-ui/components/files';
import {CpuIcon, FileCode} from 'lucide-react';


这是单节点安装指南，请查看 [**多节点**](/zh/install/multinode) 来了解真正的高可用生产环境部署。

--------

## 简化版本 [#short-version]

[准备](#prepare) 一台具有 [SSH权限](/zh/prepare/admin#check-accessibility) 的 [节点](/zh/prepare/hardware#node) 并安装 [兼容的Linux发行版](/zh/prepare/linux)，
使用免密 [`ssh`](/zh/prepare/admin#ssh) 和 [`sudo`](/zh/prepare/admin#sudo-privileges) 权限的用户：

<Steps>
    <Step>

        [**下载**](#download) pigsty，它会自动安装至 `~/pigsty` 目录，并安装 [`ansible`](/zh/admin/ansible)：

        ```bash
        curl -fsSL https://repo.pigsty.io/get | bash; cd ~/pigsty;
        ```

    </Step>
    <Step>
        使用 [`configure`](/config/configure) 生成配置清单文件，或直接根据需求调整 [`pigsty.yml`](/zh/config/inventory)：

        ```bash
        ./configure
        ```

    </Step>
    <Step>

        使用 `install.yml` 剧本，一键 [**安装部署**](#install) 所有组件：

        ```bash
        ./install.yml
        ```
    </Step>


</Steps>

**示例：在 RockyLinux 9 上的单机安装：**

[![asciicast](/img/asciinema/install.svg)](https://asciinema.org/a/673459)


------

## 准备 [#prepare]

查看 [**准备工作**](/zh/prepare) 了解所有详细信息，这里是快速摘要：

|                项目                 | 要求                       |                      项目                      | 要求                                             |
|:---------------------------------:|:-------------------------|:--------------------------------------------:|:-----------------------------------------------|
|  [节点](/zh/prepare/hardware#node)  | 至少 `1C1G`，推荐 `2C2G`      |       [规格](/zh/prepare/hardware#spec)        | 至少1个节点，2个为半高可用，3个以上真高可用                        |
|  [磁盘](/zh/prepare/hardware#disk)  | `/data`，主挂载点，`ext4/xfs`  |      [网络](/zh/prepare/hardware#network)      | 静态 IPv4 地址                                     |
|  [VIP](/zh/prepare/hardware#vip)  | 可选的 L2 VIP               |      [域名](/zh/prepare/hardware#domain)       | 可选的本地/公共域名                                     |
| [内核](/zh/prepare/software#linux)  | `Linux`                  |           [发行版](/zh/prepare/linux)           | el8, el9, d12, u22, u24 x `x86_64` / `aarch64` |
| [本地化](/zh/prepare/software#linux) | `C.UTF-8` 或 `C`          |     [防火墙](/zh/prepare/software#firewall)     | 端口：`80` / `443` / `22` / `5432`                |
|   [用户](/zh/prepare/admin#user)    | 避免使用 `root` 和 `postgres` |  [Sudo](/zh/prepare/admin#sudo-privileges)   | `nopass` sudo 权限                               |
|   [SSH](/zh/prepare/admin#ssh)    | 通过公钥 `nopass`            | [可达性](/zh/prepare/admin#check-accessibility) | `ssh <ip\|alias> sudo ls` 无错误                  |




------

## 下载 [#download]

（<span className="text-sky-500 font-black">推荐</span>）您可以使用以下命令获取并解压最新稳定版本的 pigsty 源码：

```bash tab="默认"
curl -fsSL https://repo.pigsty.io/get | bash; cd ~/pigsty
```
```bash tab="镜像"
curl -fsSL https://repo.pigsty.cc/get | bash; cd ~/pigsty   # 中国镜像
```
```bash tab="指定版本"
curl -fsSL https://repo.pigsty.io/get | bash -s v3.6.0; cd ~/pigsty
```

您也可以通过 `git`、`pig` 或直接从 [GitHub](https://github.com/pgsty/pigsty) [**下载源码**](/zh/prepare/software#pigsty) 和 [离线软件包](/zh/install/offline#what-is-offline-package) 压缩包的方式安装。

<Files>
    <Folder name="pigsty" defaultOpen>
        <a href="#configure"><File name="configure"  icon={<CpuIcon className="text-orange-400" />} /></a>
        <a href="#install"><File name="install.yml"  icon={<CpuIcon className="text-orange-400" />} /></a>
        <a href="#pigsty.yml"><File name="pigsty.yml" icon={<FileCode className="text-blue-500" />} /></a>
    </Folder>
</Files>





------

## 配置 [#configure]

[`configure`](https://github.com/pgsty/pigsty/blob/main/configure) 脚本将根据您的环境和输入生成具有良好默认值的 `pigsty.yml` 配置文件 [配置清单](/zh/config/inventory)。
这是 **可选的**，您可以如 [**教程**](/zh/config/tutorial) 所示直接编辑 `pigsty.yml`。

有许多 [**配置模板**](/zh/config/template) 供您参考，以下是一些快速示例：

```bash
./configure                  # 使用默认模板，PG 17 带最少扩展
./configure -v 16            # 使用 PG 16 而非 17 的默认元数据模板
./configure -c rich          # PG 17 带所有可用扩展和更多演示数据库
./configure -c slim          # 最小安装模板，与 ./slim.yml 剧本一起使用
./configure -c app/supa      # 使用 app/supa 自托管 supabase 配置模板
./configure -c ivory         # 使用 ivorysql 内核而非原生 PG
./configure -i 10.11.12.13   # 显式指定主 IP 地址
./configure -r china         # 使用中国镜像而非默认仓库
./configure -c full -s       # 使用 4 节点沙箱配置模板，不进行 IP 替换和探测
```

让我们不带任何参数执行 `configure`，如果发现多个 IP 地址，它可能会要求您输入主 IP 地址。

```bash
[vagrant@node-2 pigsty]$ ./configure
configure pigsty v3.6.0 begin
[ OK ] region  = default
[ OK ] kernel  = Linux
[ OK ] machine = x86_64
[ OK ] package = rpm,dnf
[ OK ] vendor  = rocky (Rocky Linux)
[ OK ] version = 9 (9.5)
[ OK ] sudo = vagrant ok
[ OK ] ssh = vagrant@127.0.0.1 ok
[WARN] Multiple IP address candidates found:
    (1) 192.168.121.24	inet 192.168.121.24/24 brd 192.168.121.255 scope global dynamic noprefixroute eth0
    (2) 10.10.10.12	    inet 10.10.10.12/24 brd 10.10.10.255 scope global noprefixroute eth1
[ IN ] INPUT primary_ip address (of current meta node, e.g 10.10.10.10):
=> 10.10.10.12    # <------- 在这里输入你的首要 IPv4 地址！
[ OK ] primary_ip = 10.10.10.12 (from input)
[ OK ] admin = vagrant@10.10.10.12 ok
[ OK ] mode = meta (el9)
[ OK ] locale  = C.UTF-8
[ OK ] configure pigsty done
proceed with ./install.yml
```

该脚本将把 IP 占位符 `10.10.10.10` 替换为当前节点的主 IPv4 地址。
在 [手动](/zh/config/tutorial) 配置 pigsty 时请注意这一点。检查生成的 `pigsty.yml` 以继续。

### 嘿！别忘了这些密码！ [#hey-dont-forget-these-passwords]

<Callout title="修改默认密码！" type="warn">

在 [安装](#install) 前，任何正式部署中请务必 <a href="/zh/config/security#passwords"><span className="text-red-500 font-bold">修改默认密码</span></a>

</Callout>

然后修改默认 [密码](/zh/config/security#passwords) 并进行必要的调整，最终的 `pigsty.yml` 可能如下所示：

```yaml title="~/pigsty/pigsty.yml"
---
all:

  #==============================================================#
  # Clusters, Nodes, and Modules
  #==============================================================#
  children:

    #----------------------------------#
    # infra: monitor, alert, repo, etc..
    #----------------------------------#
    infra:
      hosts:
        10.10.10.12: { infra_seq: 1 }
      vars:
        docker_enabled: true      # enabled docker with ./docker.yml
        docker_registry_mirrors: ["https://docker.1ms.run", "https://docker.m.daocloud.io"]

    #----------------------------------#
    # etcd cluster for HA postgres DCS
    #----------------------------------#
    etcd:
      hosts:
        10.10.10.12: { etcd_seq: 1 }
      vars:
        etcd_cluster: etcd

    #----------------------------------#
    # minio (OPTIONAL backup repo)
    #----------------------------------#
    #minio:
    #  hosts:
    #    10.10.10.12: { minio_seq: 1 }
    #  vars:
    #    minio_cluster: minio

    #----------------------------------#
    # pgsql (singleton on current node)
    #----------------------------------#
    # this is an example single-node postgres cluster with pgvector installed, with one biz database & two biz users
    pg-meta:
      hosts:
        10.10.10.12: { pg_seq: 1, pg_role: primary } # <---- primary instance with read-write capability
        #x.xx.xx.xx: { pg_seq: 2, pg_role: replica } # <---- read only replica for read-only online traffic
        #x.xx.xx.xy: { pg_seq: 3, pg_role: offline } # <---- offline instance of ETL & interactive queries
      vars:
        pg_cluster: pg-meta                 # required identity parameter, usually same as group name

        # define business databases here: https://pgsty.com/pgsql/db
        pg_databases:                       # define business databases on this cluster, array of database definition
          - name: meta                      # REQUIRED, `name` is the only mandatory field of a database definition
            baseline: cmdb.sql              # optional, database sql baseline path, (relative path among ansible search path, e.g: files/)
            schemas: [ pigsty ]             # optional, additional schemas to be created, array of schema names
            extensions:                     # optional, additional extensions to be installed: array of `{name[,schema]}`
              - { name: vector }            # install pgvector extension on this database by default
            comment: pigsty meta database   # optional, comment string for this database
            #pgbouncer: true                # optional, add this database to pgbouncer database list? true by default
            #owner: postgres                # optional, database owner, postgres by default
            #template: template1            # optional, which template to use, template1 by default
            #encoding: UTF8                 # optional, database encoding, UTF8 by default. (MUST same as template database)
            #locale: C                      # optional, database locale, C by default.  (MUST same as template database)
            #lc_collate: C                  # optional, database collate, C by default. (MUST same as template database)
            #lc_ctype: C                    # optional, database ctype, C by default.   (MUST same as template database)
            #tablespace: pg_default         # optional, default tablespace, 'pg_default' by default.
            #allowconn: true                # optional, allow connection, true by default. false will disable connect at all
            #revokeconn: false              # optional, revoke public connection privilege. false by default. (leave connect with grant option to owner)
            #register_datasource: true      # optional, register this database to grafana datasources? true by default
            #connlimit: -1                  # optional, database connection limit, default -1 disable limit
            #pool_auth_user: dbuser_meta    # optional, all connection to this pgbouncer database will be authenticated by this user
            #pool_mode: transaction         # optional, pgbouncer pool mode at database level, default transaction
            #pool_size: 64                  # optional, pgbouncer pool size at database level, default 64
            #pool_size_reserve: 32          # optional, pgbouncer pool size reserve at database level, default 32
            #pool_size_min: 0               # optional, pgbouncer pool size min at database level, default 0
            #pool_max_db_conn: 100          # optional, max database connections at database level, default 100
          #- { name: grafana  ,owner: dbuser_grafana  ,revokeconn: true ,comment: grafana primary database }  # define another database

        # define business users here: https://pgsty.com/pgsql/user
        pg_users:                           # define business users/roles on this cluster, array of user definition
          - name: dbuser_meta               # REQUIRED, `name` is the only mandatory field of a user definition
            password: DBUser.Meta           # optional, password, can be a scram-sha-256 hash string or plain text
            login: true                     # optional, can log in, true by default  (new biz ROLE should be false)
            superuser: false                # optional, is superuser? false by default
            createdb: false                 # optional, can create database? false by default
            createrole: false               # optional, can create role? false by default
            inherit: true                   # optional, can this role use inherited privileges? true by default
            replication: false              # optional, can this role do replication? false by default
            bypassrls: false                # optional, can this role bypass row level security? false by default
            pgbouncer: true                 # optional, add this user to pgbouncer user-list? false by default (production user should be true explicitly)
            connlimit: -1                   # optional, user connection limit, default -1 disable limit
            expire_in: 3650                 # optional, now + n days when this role is expired (OVERWRITE expire_at)
            expire_at: '2030-12-31'         # optional, YYYY-MM-DD 'timestamp' when this role is expired  (OVERWRITTEN by expire_in)
            comment: pigsty admin user      # optional, comment string for this user/role
            roles: [dbrole_admin]           # optional, belonged roles. default roles are: dbrole_{admin,readonly,readwrite,offline}
            parameters: {}                  # optional, role level parameters with `ALTER ROLE SET`
            pool_mode: transaction          # optional, pgbouncer pool mode at user level, transaction by default
            pool_connlimit: -1              # optional, max database connections at user level, default -1 disable limit
          - { name: dbuser_view ,password: DBUser.Viewer ,pgbouncer: true ,roles: [dbrole_readonly], comment: read-only viewer for meta database }

        # define pg extensions: https://pgsty.com/pgsql/extension
        pg_libs: 'pg_stat_statements, auto_explain' # add timescaledb to shared_preload_libraries
        pg_extensions: [ pgvector ] # check list for available extension for your pg & os combination: https://ext.pgsty.com/list

        # define HBA rules here: https://pgsty.com/pgsql/hba
        pg_hba_rules:                       # example hba rules
          - {user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title: 'allow grafana dashboard access cmdb from infra nodes'}

        #pg_vip_enabled: true               # define a L2 VIP which bind to cluster primary instance
        #pg_vip_address: 10.10.10.2/24      # L2 VIP Address and netmask
        #pg_vip_interface: eth1             # L2 VIP Network interface, overwrite on host vars if member have different network interface names
        node_crontab: [ '00 01 * * * postgres /pg/bin/pg-backup full' ] # make a full backup every 1am


  #==============================================================#
  # Global Parameters
  #==============================================================#
  vars:

    #----------------------------------#
    # Meta Data
    #----------------------------------#
    version: v3.6.0                   # pigsty version string
    admin_ip: 10.10.10.12             # admin node ip address
    region: china                     # upstream mirror region: default|china|europe
    pg_locale: C.UTF-8                # overwrite default C local
    pg_lc_collate: C.UTF-8            # overwrite default C lc_collate
    pg_lc_ctype: C.UTF-8              # overwrite default C lc_ctype

    node_tune: oltp                   # node tuning specs: oltp,olap,tiny,crit
    pg_conf: oltp.yml                 # pgsql tuning specs: {oltp,olap,tiny,crit}.yml
    proxy_env:                        # global proxy env when downloading packages
      no_proxy: "localhost,127.0.0.1,10.0.0.0/8,192.168.0.0/16,*.pigsty,*.aliyun.com,mirrors.*,*.myqcloud.com,*.tsinghua.edu.cn"
      # http_proxy:  # set your proxy here: e.g http://user:pass@proxy.xxx.com
      # https_proxy: # set your proxy here: e.g http://user:pass@proxy.xxx.com
      # all_proxy:   # set your proxy here: e.g http://user:pass@proxy.xxx.com
    infra_portal:                     # domain names and upstream servers
      home         : { domain: h.pigsty }
      grafana      : { domain: g.pigsty ,endpoint: "${admin_ip}:3000" , websocket: true }
      prometheus   : { domain: p.pigsty ,endpoint: "${admin_ip}:9090" }
      alertmanager : { domain: a.pigsty ,endpoint: "${admin_ip}:9093" }
      blackbox     : { endpoint: "${admin_ip}:9115" }
      loki         : { endpoint: "${admin_ip}:3100" }
      #minio        : { domain: m.pigsty ,endpoint: "${admin_ip}:9001" ,scheme: https ,websocket: true }

    #----------------------------------#
    # MinIO Related Options
    #----------------------------------#
    #pgbackrest_method: minio          # if you want to use minio as backup repo instead of 'local' fs, uncomment this
    #minio_users:                      # and configure `pgbackrest_repo` & `minio_users` accordingly
    #  - { access_key: dba , secret_key: S3User.DBA, policy: consoleAdmin }
    #  - { access_key: pgbackrest , secret_key: S3User.Backup, policy: readwrite }
    #pgbackrest_repo:                  # pgbackrest repo: https://pgbackrest.org/configuration.html#section-repository
    #  minio: ...                      # optional minio repo for pgbackrest ...
    #    s3_key: pgbackrest            # minio user access key for pgbackrest
    #    s3_key_secret: S3User.Backup  # minio user secret key for pgbackrest
    #    cipher_pass: pgBackRest       # AES encryption password, default is 'pgBackRest'
    # if you want to use minio as backup repo instead of 'local' fs, uncomment this, and configure `pgbackrest_repo`
    #pgbackrest_method: minio
    #node_etc_hosts: [ '10.10.10.12 h.pigsty a.pigsty p.pigsty g.pigsty sss.pigsty' ]

    #----------------------------------#
    # Credential: CHANGE THESE PASSWORDS
    #----------------------------------#
    #grafana_admin_username: admin
    grafana_admin_password: pigsty             # <----- CHANGE ME
    #pg_admin_username: dbuser_dba
    pg_admin_password: DBUser.DBA              # <----- CHANGE ME
    #pg_monitor_username: dbuser_monitor
    pg_monitor_password: DBUser.Monitor        # <----- CHANGE ME
    #pg_replication_username: replicator
    pg_replication_password: DBUser.Replicator # <----- CHANGE ME
    #patroni_username: postgres
    patroni_password: Patroni.API              # <----- CHANGE ME
    #haproxy_admin_username: admin
    haproxy_admin_password: pigsty             # <----- CHANGE ME
    #minio_access_key: minioadmin
    minio_secret_key: minioadmin               # <----- CHANGE ME

    #----------------------------------#
    # Safe Guard
    #----------------------------------#
    # you can enable these flags after bootstrap, to prevent purging running etcd / pgsql instances
    etcd_safeguard: false             # prevent purging running etcd instance?
    pg_safeguard: false               # prevent purging running postgres instance? false by default

    #----------------------------------#
    # Repo, Node, Packages
    #----------------------------------#
    repo_remove: true                 # remove existing repo on admin node during repo bootstrap
    node_repo_remove: true            # remove existing node repo for node managed by pigsty
    repo_extra_packages: [ pg17-main ] #,pg17-core ,pg17-time ,pg17-gis ,pg17-rag ,pg17-fts ,pg17-olap ,pg17-feat ,pg17-lang ,pg17-type ,pg17-util ,pg17-func ,pg17-admin ,pg17-stat ,pg17-sec ,pg17-fdw ,pg17-sim ,pg17-etl]
    pg_version: 17                    # default postgres version
    #pg_extensions: [pg17-time ,pg17-gis ,pg17-rag ,pg17-fts ,pg17-feat ,pg17-lang ,pg17-type ,pg17-util ,pg17-func ,pg17-admin ,pg17-stat ,pg17-sec ,pg17-fdw ,pg17-sim ,pg17-etl ] #,pg17-olap]
```

<Callout title="如果想要更多扩展怎么办？" type="info">

    只需在 `pigsty.yml` 中取消注释以下两个参数，使其看起来像这样：

```yaml
repo_extra_packages: [ pg17-main ,pg17-core ,pg17-time ,pg17-gis ,pg17-rag ,pg17-fts ,pg17-olap ,pg17-feat ,pg17-lang ,pg17-type ,pg17-util ,pg17-func ,pg17-admin ,pg17-stat ,pg17-sec ,pg17-fdw ,pg17-sim ,pg17-etl]
pg_extensions: [pg17-time ,pg17-gis ,pg17-rag ,pg17-fts ,pg17-feat ,pg17-lang ,pg17-type ,pg17-util ,pg17-func ,pg17-admin ,pg17-stat ,pg17-sec ,pg17-fdw ,pg17-sim ,pg17-etl ] #,pg17-olap]
```

    您可以用配置文件做更多神奇的事情，查看 [**配置**](/zh/config) 了解详情。

</Callout>



------

## 安装 [#install]

Pigsty 中的一切都在 [配置清单](/zh/config/inventory) 中描述：即 [上面](#configure) 生成的 `pigsty.yml` 蓝图。

运行 [`install.yml`](/zh/admin/playbook#deployment) [副本](/zh/admin/playbook) 将其实现为现实。

```bash title="~/pigsty"
./install.yml
```

如果您在输出中看到类似 `pgsql init done` 或 `grafana datasource meta`、`PLAY RECAP` 等内容，说明安装已经完成！

```bash
......

TASK [pgsql : pgsql init done] *************************************************
ok: [10.10.10.11] => {
    "msg": "postgres://10.10.10.11/postgres | meta  | dbuser_meta dbuser_view "
}
......

TASK [pg_monitor : load grafana datasource meta] *******************************
changed: [10.10.10.11]

PLAY RECAP *********************************************************************
10.10.10.11                : ok=302  changed=232  unreachable=0    failed=0    skipped=65   rescued=0    ignored=1
localhost                  : ok=6    changed=3    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0
```


有时上游仓库（如 linux / pgdg 仓库）可能会损坏，这确实会时不时发生，并导致安装失败。
您可以使用预制的 [离线软件包](/zh/install/offline#what-is-offline-package) 来解决这个问题。


<Callout title="在现有部署上绝不要再次运行这个！" type="error">

完整重新运行这个副本将会摧毁（清除）当前部署并创建一个新的！

如果您对 [ansible](/zh/admin/ansible) 有足够的了解并知道自己在做什么，仍请谨慎操作！

</Callout>


安装完成后，您可以探索 [**界面**](/zh/install/interface) 并部署 [**更多节点**](#more) 和更多高可用数据库集群。






------

## 更多 [#more]

您可以使用 pigsty 部署和监控 [更多集群](/zh/install/multinode)：向 [配置清单](/zh/config/inventory) 添加定义并运行：

```bash
bin/node-add pg-test    # 初始化集群 pg-test 的 3 个节点
bin/pgsql-add pg-test   # 初始化高可用 PGSQL 集群 pg-test
bin/redis-add redis-ms  # 初始化 redis 集群 redis-ms
```

记住，大多数模块都需要先安装 [`NODE`](/zh/node/) 模块。查看可用的 [**模块**](/zh/intro/module) 了解详情

[**`PGSQL`**](/zh/pgsql/)、[**`INFRA`**](/zh/infra/)、[**`NODE`**](/zh/node/)、[**`ETCD`**](/zh/etcd/)、
[**`MINIO`**](/zh/minio/)、[**`REDIS`**](/zh/redis/)、[**`FERRET`**](/zh/ferret/)、[**`DOCKER`**](/zh/node/)……



